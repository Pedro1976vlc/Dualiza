<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_effects.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4.1.1.- Ejemplo práctico con Angular. | UD 3: Detección y corrección de vulnerabilidades en aplicaciones web </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Pedro Antonio Santiago Santiago y José Gaspar Sánchez García" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_effects.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-135"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">UD 3: Detección y corrección de vulnerabilidades en aplicaciones web</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UD3. DETECCIÓN Y CORRECCIÓN DE VULNERABILIDADES DE APLICACIONES WEB</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li><a href="introduccin.html" class="no-ch">Introducción</a></li>
   <li><a href="1_protocolo_http.html" class="daddy">1.- Protocolo HTTP.</a>
   <ul class="other-section">
      <li><a href="11_formato_del_mensaje_http.html" class="no-ch">1.1.- Formato del mensaje HTTP.</a></li>
      <li><a href="12_versiones_del_protocolo.html" class="no-ch">1.2.- Versiones del protocolo.</a></li>
      <li><a href="13_tecnologas_web.html" class="no-ch">1.3. -Tecnologías Web.</a></li>
   </ul>
   </li>
   <li><a href="2desarrollo_seguro_de_aplicaciones_web.html" class="no-ch">2.-Desarrollo seguro de aplicaciones web.</a></li>
   <li><a href="3_listas_pblicas_de_vulnerabilidades_de_aplicaciones_web_owasp_top_ten.html" class="daddy">3.- Listas públicas de vulnerabilidades de aplicaciones web. OWASP Top Ten.</a>
   <ul class="other-section">
      <li><a href="31__inyeccin.html" class="no-ch">3.1. - Inyección.</a></li>
      <li><a href="32__prdida_de_autenticacin.html" class="no-ch">3.2. - Pérdida de autenticación.</a></li>
      <li><a href="33__exposicin_de_datos_sensibles.html" class="no-ch">3.3. - Exposición de datos sensibles.</a></li>
      <li><a href="34__entidades_externas_xml_xxe.html" class="no-ch">3.4. - Entidades externas XML (XXE).</a></li>
      <li><a href="35_prdida_de_control_de_acceso.html" class="no-ch">3.5. -Pérdida de Control de Acceso.</a></li>
      <li><a href="36_configuracin_de_seguridad_incorrecta.html" class="no-ch">3.6. -Configuración de seguridad incorrecta.</a></li>
      <li><a href="37__crosssite_scriptingxss.html" class="no-ch">3.7. - Cross-Site Scripting(XSS).</a></li>
      <li><a href="38__deserializacin_insegura.html" class="no-ch">3.8. - Deserialización insegura.</a></li>
      <li><a href="39__componentes_con_vulnerabilidades_conocidas.html" class="no-ch">3.9. - Componentes con vulnerabilidades conocidas.</a></li>
      <li><a href="310__registro_y_monitoreo_insuficientes.html" class="no-ch">3.10. - Registro y monitoreo insuficientes.</a></li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="4_entrada_basada_en_formularios_inyeccin_validacin_de_la_entrada.html" class="current-page-parent daddy">4.- Entrada basada en formularios. Inyección. Validación de la entrada.</a>
   <ul>
      <li class="current-page-parent"><a href="41__validacin_en_el_cliente.html" class="current-page-parent daddy">4.1. - Validación en el cliente.</a>
      <ul>
         <li id="active"><a href="411_ejemplo_prctico_con_angular.html" class="active no-ch">4.1.1.- Ejemplo práctico con Angular.</a></li>
      </ul>
      </li>
      <li><a href="42__validacin_en_el_servidor.html" class="daddy">4.2. - Validación en el servidor.</a>
      <ul class="other-section">
         <li><a href="421_ejemplo_prctico_con_nodejs.html" class="no-ch">4.2.1.- Ejemplo práctico con NodeJs</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="5__estndares_de_autenticacin_y_autorizacin.html" class="daddy">5. - Estándares de autenticación y autorización.</a>
   <ul class="other-section">
      <li><a href="51__elementos_de_un_sistema_de_autenticacin_y_autorizacin_bsico.html" class="no-ch">5.1. - Elementos de un sistema de autenticación y autorización básico.</a></li>
      <li><a href="52__estndares.html" class="daddy">5.2. - Estándares.</a>
      <ul class="other-section">
         <li><a href="521__tokens_jwt.html" class="daddy">5.2.1. - Tokens JWT</a>
         <ul class="other-section">
            <li><a href="5211__ejemplo_prctico_con_nodejs.html" class="no-ch">5.2.1.1. - Ejemplo práctico con NodeJs.</a></li>
         </ul>
         </li>
         <li><a href="522__oath.html" class="no-ch">5.2.2. - OAth.</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="6__robo_de_sesin.html" class="no-ch">6. - Robo de sesión.</a></li>
   <li><a href="7__almacenamiento_seguro_de_contraseas.html" class="daddy">7. - Almacenamiento seguro de contraseñas.</a>
   <ul class="other-section">
      <li><a href="71_ejemplo_almacenamiento_seguro_nodejs.html" class="no-ch">7.1.- Ejemplo almacenamiento seguro NodeJs.</a></li>
   </ul>
   </li>
   <li><a href="8__contramedidas_hsts_csp_captchas_entre_otros.html" class="daddy">8. - Contramedidas. HSTS, CSP, CAPTCHAs, entre otros.</a>
   <ul class="other-section">
      <li><a href="81__hsts_http_strict_transport_security.html" class="no-ch">8.1. - HSTS (HTTP Strict Transport Security)</a></li>
      <li><a href="82__csp_content_security_policy.html" class="no-ch">8.2. - CSP (Content Security Policy)</a></li>
      <li><a href="83__captchas.html" class="no-ch">8.3. - CAPTCHAs</a></li>
   </ul>
   </li>
   <li><a href="9__seguridad_de_portales_y_aplicativos_web_soluciones_wafweb_application_firewall.html" class="no-ch">9. - Seguridad de portales y aplicativos web. Soluciones WAF(Web Application Firewall).</a></li>
   <li><a href="caso_prctico.html" class="no-ch">Caso práctico.</a></li>
   <li><a href="glosario.html" class="no-ch">Glosario</a></li>
   <li><a href="bibliografa.html" class="no-ch">Bibliografía</a></li>
   <li><a href="resumen.html" class="no-ch">Resumen</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="41__validacin_en_el_cliente.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="42__validacin_en_el_servidor.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">4.1.1.- Ejemplo práctico con Angular.</h1></header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id331">
<div class="iDevice emphasis0">
<div id="ta331_154" class="block iDevice_content">
<p>Existen muchas librerías y frameworks que permiten la validación de datos en el cliente. Es imposible tratar en profundidad todas, incluyo limitarse a las más usadas (Angular, React, Vue...). Este es un ejemplo de la validación de datos de entrada para la edición de usuarios de una clínica dedicada a la nutrición y dietética.</p>
<p>Angular implementa 2 tipos de validación de formularios, por plantillas y reactivos, este ejemplo se centra en los reactivos.</p>
<p>Se basa en la utilización de una serie de clases donde la gestión del formulario recae en la lógica internan, no en el HTML:</p>
<ul>
<li>FormGroup: Contenedor de controles del formulario, asociado normalmente a la etiqueta form.</li>
<li>FormControl: Objeto que se asocia a un elemento del formulario y en que se definen sus características, como los datos permitidos.</li>
<li>FormBuilder: Construye y asocia el modelo a las etiquetas HTML.</li>
</ul>
<p>Se ha de indicar a Angular que se desea utilizar los formularios reactivos en el fichero <strong>app.modules.ts</strong>, en el que se definen las clases, paquetes y librerías a utilizar:</p>
<div class="highlighted-code language-java">
<div>
<pre><code>import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';

import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { ReactiveFormsModule } from '@angular/forms';
@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    AppRoutingModule,
    ReactiveFormsModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }</code></pre>
</div>
</div>
<p>Ahora ya es posible la creación de formularios y su gestión. Indicar que Angular utiliza como bloque básico los componentes. Un componente se componen de una plantilla(HTML) una hoja de estilo y una serie de métodos y atributos en los que recae la lógica del mismo.</p>
<div class="exe-fx exe-accordion">
<h2>Definir el formulario HTML</h2>
<div class="highlighted-code language-markup">
<div>
<pre><code>&lt;div class="container" &gt;
  &lt;h1 class="text-center pt-1"&gt;Formulario clínica PPSE&lt;/h1&gt;
  &lt;form&gt;
    &lt;div class="form-group row pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Nombre&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-group row pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Apellidos&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-group row"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Dirección&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-group row pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Teléfono&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="row pt-2"&gt;
      &lt;div class="col-4"&gt;
        &lt;div class="form-group row pt-2"&gt;
          &lt;label class="col-4 col-form-label"&gt;Edad(Años)&lt;/label&gt;
          &lt;div class="col-8"&gt;
            &lt;input type="number" class="form-control" min="0" max="110"&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="col-4"&gt;
        &lt;div class="form-group row pt-2"&gt;
          &lt;label class="col-4 col-form-label"&gt;Peso(Kg)&lt;/label&gt;
          &lt;div class="col-sm-8"&gt;
            &lt;input type="number" class="form-control" min="40" max="300"&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="col-4"&gt;
        &lt;div class="form-group row pt-2"&gt;
          &lt;label class="col-4 col-form-label"&gt;Altura(Cm)&lt;/label&gt;
          &lt;div class="col-8"&gt;
            &lt;input type="number" class="form-control" min="100" max="250"&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="row pt-3 "&gt;
      &lt;div class="col "&gt;
        &lt;button type="submit" class="btn btn-primary float-end"&gt;Guardar&lt;/button&gt;

      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<h2>Creando el formulario.</h2>
<p>Usando la clase FormBuilder inyectada se construye el formulario:</p>
<div class="highlighted-code language-markup line-numbers">
<div>
<pre><code>import { Component, OnInit } from '@angular/core';
import { FormGroup, FormControl, Validators } from '@angular/forms';
import { FormBuilder } from '@angular/forms';
@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent  {
  title = 'clinicaPPSE';
  formulario:FormGroup;
  constructor(private fb: FormBuilder){
    this.formulario=this.fb.group({
      nombre: new FormControl('',[Validators.required, Validators.maxLength(50)]),
      apellidos:new FormControl('',[Validators.required, Validators.maxLength(100)]),
      direccion:new FormControl('',[Validators.required, Validators.maxLength(200)]),
      telefono:new FormControl('',[Validators.required, Validators.pattern("(6|7)[ -]*([0-9][ -]*){8}")]),
      peso:new FormControl('',[Validators.required, Validators.min(40), Validators.max(300)]),
      altura:new FormControl('',[Validators.required,  Validators.min(100), Validators.max(250)]),
      edad:new FormControl('',[Validators.required,  Validators.min(0), Validators.max(110)])
    })
  }  
}</code></pre>
</div>
</div>
<p>Se define un atributo de la clase llamada formulario creado utilizando el método ForBuilder.Group con los campos que componen el formulario, para cada uno de ellos se indica su nombre (debe coincidir con el atributo formControlName del HTML, que se añade en el siguiente punto) y se crea un objeto de tipo  FormControl, en el que su segundo parámetros es un lista de requerimientos que ha de cumplir el campo para ser válido, destacar el validador Validators.pattern para expresiones regulares.</p>
<p> </p>
<h2>Modificando los atributos de los campos del formulario.</h2>
<p>Se modifica el HTML para que se construya el formulario de forma automática utilizando el atributo formControName, además se han añadido mensajes de error en la validación y una condición en el botón de envío para que solo esté activo en caso de que el formulario sea válido.</p>
<div class="highlighted-code language-php line-numbers">
<div>
<pre><code>&lt;div class="container" [formGroup]="formulario" &gt;
  &lt;h1 class="text-center pt-1"&gt;Formulario clínica PPSE&lt;/h1&gt;
  &lt;form&gt;
    &lt;div class="form-group row pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Nombre&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control" formControlName="nombre"&gt;


      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="form-group row pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Apellidos&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control" formControlName="apellidos"&gt;


      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-group row  pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Dirección&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control" formControlName="direccion"&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-group row pt-2"&gt;
      &lt;label class="col-sm-2 col-form-label"&gt;Teléfono&lt;/label&gt;
      &lt;div class="col-sm-10"&gt;
        &lt;input type="text" class="form-control" formControlName="telefono"&gt;
        &lt;div *ngIf="formulario.get('telefono')?.invalid &amp;&amp; (formulario.get('telefono')?.dirty || formulario.get('telefono')?.touched)"&gt;
          &lt;small *ngIf="formulario.get('telefono')?.errors?.required" class="form-text text-danger" &gt;El teléfono es necesario.&lt;/small&gt; 
          &lt;small *ngIf="formulario.get('telefono')?.errors?.pattern" class="form-text text-danger" &gt;El formato del teléfono no es válido.&lt;/small&gt;  
       
        &lt;/div&gt;
        
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="row pt-2"&gt;
      &lt;div class="col-4"&gt;
        &lt;div class="form-group row pt-2"&gt;
          &lt;label class="col-4 col-form-label"&gt;Edad(Años)&lt;/label&gt;
          &lt;div class="col-8"&gt;
            &lt;input type="number" class="form-control" min="0" max="110" formControlName="edad"&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="col-4"&gt;
        &lt;div class="form-group row pt-2"&gt;
          &lt;label class="col-4 col-form-label"&gt;Peso(Kg)&lt;/label&gt;
          &lt;div class="col-sm-8"&gt;
            &lt;input type="number" class="form-control" min="40" max="300" formControlName="peso"&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="col-4"&gt;
        &lt;div class="form-group row pt-2"&gt;
          &lt;label class="col-4 col-form-label"&gt;Altura(Cm)&lt;/label&gt;
          &lt;div class="col-8"&gt;
            &lt;input type="number" class="form-control" min="100" max="250" formControlName="altura"&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="row pt-3 "&gt;
      &lt;div class="col "&gt;
        &lt;button type="submit" class="btn btn-primary float-end" [disabled]="!formulario.valid" (click)="formJSONalert()"&gt;Guardar&lt;/button&gt;
{{formulario.valid}}
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<p>También se añade el evento click en el botón que muestra los datos del formulario en formato JSON, que podría ser enviado al servidor con servicios REST. El método es:</p>
<div class="highlighted-code language-js">
<div>
<pre><code>  formJSONalert(){
    var cadena='{'
    Object.keys(this.formulario.controls).forEach(key =&gt; {
      if(isNaN(this.formulario.controls[key].value))
        cadena+='"'+key+'":"'+this.formulario.controls[key].value+'",';
      else
        cadena+='"'+key+'":'+this.formulario.controls[key].value+',';
    });
    cadena=cadena.substr(0,cadena.length-1);
    cadena+='}';
    alert(cadena)
  }</code></pre>
</div>
</div>
<p></p>
<p></p>
</div>
<p></p>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="41__validacin_en_el_cliente.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="42__validacin_en_el_servidor.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>