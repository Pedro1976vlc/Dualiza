<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_effects.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>5.2.2. - OAth. | UD 3: Detección y corrección de vulnerabilidades en aplicaciones web </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Pedro Antonio Santiago Santiago y José Gaspar Sánchez García" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_effects.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-130"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">UD 3: Detección y corrección de vulnerabilidades en aplicaciones web</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UD3. DETECCIÓN Y CORRECCIÓN DE VULNERABILIDADES DE APLICACIONES WEB</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li><a href="introduccin.html" class="no-ch">Introducción</a></li>
   <li><a href="1_protocolo_http.html" class="daddy">1.- Protocolo HTTP.</a>
   <ul class="other-section">
      <li><a href="11_formato_del_mensaje_http.html" class="no-ch">1.1.- Formato del mensaje HTTP.</a></li>
      <li><a href="12_versiones_del_protocolo.html" class="no-ch">1.2.- Versiones del protocolo.</a></li>
      <li><a href="13_tecnologas_web.html" class="no-ch">1.3. -Tecnologías Web.</a></li>
   </ul>
   </li>
   <li><a href="2desarrollo_seguro_de_aplicaciones_web.html" class="no-ch">2.-Desarrollo seguro de aplicaciones web.</a></li>
   <li><a href="3_listas_pblicas_de_vulnerabilidades_de_aplicaciones_web_owasp_top_ten.html" class="daddy">3.- Listas públicas de vulnerabilidades de aplicaciones web. OWASP Top Ten.</a>
   <ul class="other-section">
      <li><a href="31__inyeccin.html" class="no-ch">3.1. - Inyección.</a></li>
      <li><a href="32__prdida_de_autenticacin.html" class="no-ch">3.2. - Pérdida de autenticación.</a></li>
      <li><a href="33__exposicin_de_datos_sensibles.html" class="no-ch">3.3. - Exposición de datos sensibles.</a></li>
      <li><a href="34__entidades_externas_xml_xxe.html" class="no-ch">3.4. - Entidades externas XML (XXE).</a></li>
      <li><a href="35_prdida_de_control_de_acceso.html" class="no-ch">3.5. -Pérdida de Control de Acceso.</a></li>
      <li><a href="36_configuracin_de_seguridad_incorrecta.html" class="no-ch">3.6. -Configuración de seguridad incorrecta.</a></li>
      <li><a href="37__crosssite_scriptingxss.html" class="no-ch">3.7. - Cross-Site Scripting(XSS).</a></li>
      <li><a href="38__deserializacin_insegura.html" class="no-ch">3.8. - Deserialización insegura.</a></li>
      <li><a href="39__componentes_con_vulnerabilidades_conocidas.html" class="no-ch">3.9. - Componentes con vulnerabilidades conocidas.</a></li>
      <li><a href="310__registro_y_monitoreo_insuficientes.html" class="no-ch">3.10. - Registro y monitoreo insuficientes.</a></li>
   </ul>
   </li>
   <li><a href="4_entrada_basada_en_formularios_inyeccin_validacin_de_la_entrada.html" class="daddy">4.- Entrada basada en formularios. Inyección. Validación de la entrada.</a>
   <ul class="other-section">
      <li><a href="41__validacin_en_el_cliente.html" class="daddy">4.1. - Validación en el cliente.</a>
      <ul class="other-section">
         <li><a href="411_ejemplo_prctico_con_angular.html" class="no-ch">4.1.1.- Ejemplo práctico con Angular.</a></li>
      </ul>
      </li>
      <li><a href="42__validacin_en_el_servidor.html" class="daddy">4.2. - Validación en el servidor.</a>
      <ul class="other-section">
         <li><a href="421_ejemplo_prctico_con_nodejs.html" class="no-ch">4.2.1.- Ejemplo práctico con NodeJs</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="5__estndares_de_autenticacin_y_autorizacin.html" class="current-page-parent daddy">5. - Estándares de autenticación y autorización.</a>
   <ul>
      <li><a href="51__elementos_de_un_sistema_de_autenticacin_y_autorizacin_bsico.html" class="no-ch">5.1. - Elementos de un sistema de autenticación y autorización básico.</a></li>
      <li class="current-page-parent"><a href="52__estndares.html" class="current-page-parent daddy">5.2. - Estándares.</a>
      <ul>
         <li><a href="521__tokens_jwt.html" class="daddy">5.2.1. - Tokens JWT</a>
         <ul class="other-section">
            <li><a href="5211__ejemplo_prctico_con_nodejs.html" class="no-ch">5.2.1.1. - Ejemplo práctico con NodeJs.</a></li>
         </ul>
         </li>
         <li id="active"><a href="522__oath.html" class="active no-ch">5.2.2. - OAth.</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="6__robo_de_sesin.html" class="no-ch">6. - Robo de sesión.</a></li>
   <li><a href="7__almacenamiento_seguro_de_contraseas.html" class="daddy">7. - Almacenamiento seguro de contraseñas.</a>
   <ul class="other-section">
      <li><a href="71_ejemplo_almacenamiento_seguro_nodejs.html" class="no-ch">7.1.- Ejemplo almacenamiento seguro NodeJs.</a></li>
   </ul>
   </li>
   <li><a href="8__contramedidas_hsts_csp_captchas_entre_otros.html" class="daddy">8. - Contramedidas. HSTS, CSP, CAPTCHAs, entre otros.</a>
   <ul class="other-section">
      <li><a href="81__hsts_http_strict_transport_security.html" class="no-ch">8.1. - HSTS (HTTP Strict Transport Security)</a></li>
      <li><a href="82__csp_content_security_policy.html" class="no-ch">8.2. - CSP (Content Security Policy)</a></li>
      <li><a href="83__captchas.html" class="no-ch">8.3. - CAPTCHAs</a></li>
   </ul>
   </li>
   <li><a href="9__seguridad_de_portales_y_aplicativos_web_soluciones_wafweb_application_firewall.html" class="no-ch">9. - Seguridad de portales y aplicativos web. Soluciones WAF(Web Application Firewall).</a></li>
   <li><a href="caso_prctico.html" class="no-ch">Caso práctico.</a></li>
   <li><a href="glosario.html" class="no-ch">Glosario</a></li>
   <li><a href="bibliografa.html" class="no-ch">Bibliografía</a></li>
   <li><a href="resumen.html" class="no-ch">Resumen</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="5211__ejemplo_prctico_con_nodejs.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="6__robo_de_sesin.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">5.2.2. - OAth.</h1></header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id262">
<div class="iDevice emphasis0">
<div id="ta262_154" class="block iDevice_content">
<p><span style="font-weight: 400;">Los token permiten interactuar entre cliente y servidor, y la información del usuario se encuentra en el servidor, por ejemplo en una interfaz web para correo: el usuario, la contraseña, la lista de contactos o los correos recibidos. Pero junto con el crecimiento web ha surgido la necesidad de comunicación e intercambio de información entre usuarios, aplicaciones en el que usuario posee cuenta y aplicaciones terceras en las que no tiene cuenta. </span></p>
<p><span style="font-weight: 400;">Se necesita:</span></p>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Autenticación de usuarios ante aplicaciones en las que no se dispone de cuenta.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Permitir a aplicaciones de terceros acceder a información almacenada en la aplicación en la que el usuario posee cuenta.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;"><span style="font-weight: 400;"><span style="font-weight: 400;">Delegar acciones del usuario a entidades terceras como una aplicación para realizar acciones en la que posee cuentas.</span></span></span>
<figure class="exe-figure exe-image position-center" style="width: 150px;"><img width="150" height="151" alt="Logo de OAth" src="oath.png" />
<figcaption class="figcaption"><a class="author" href="https://commons.wikimedia.org/wiki/File:Oauth_logo.svg" target="_blank" rel="noopener">Chris Messina</a>. <span class="title"><em>Logo de OAth</em></span></figcaption>
</figure>
</li>
</ul>
<p style="color: #333333; font-family: &amp;quot; quicksand&amp;quot;,&amp;quot;open sans&amp;quot;,​arial,helvetica,​sans-serif; font-size: 17.6px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px; margin: 1em 0px 1em 0px;"><span style="font-weight: 400;">Para ofrecer estas funcionalidades se define el estándar abierto OAuth, que se encuentra en la versión 2.0 y que no se limita únicamente a aplicaciones web, sino que puede ser utilizado en aplicaciones nativas e híbridas, para móviles y versión escritorio. En la página oficial de </span><a style="color: #65adc5;" href="https://oauth.net/"><span style="font-weight: 400;">Oauth</span></a><span style="font-weight: 400;"> se puede encontrar la especificación, artículos y vídeos sobre el estándar.</span></p>
<p style="color: #333333; font-family: &amp;quot; quicksand&amp;quot;,&amp;quot;open sans&amp;quot;,​arial,helvetica,​sans-serif; font-size: 17.6px; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px; margin: 1em 0px 1em 0px;"><span style="font-weight: 400;">Si hasta este momento los roles son cliente (navegador) y servidor, en este caso se introducen nuevos actores que permiten la funcionalidad anterior:</span></p>
<ul style="color: #666666; font-family: &amp;quot; quicksand&amp;quot;,&amp;quot;open sans&amp;quot;,​arial,helvetica,​sans-serif; font-size: 0.95em; font-style: normal; font-variant: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-decoration: none; text-indent: 0px; text-transform: none; -webkit-text-stroke-width: 0px; white-space: normal; word-spacing: 0px;">
<li aria-level="1" style="font-weight: 400; list-style-position: outside; margin-bottom: 0.2em; margin-top: 0.2em;"><b>Propietario del recurso/ Resource Owne</b><span style="font-weight: 400;">r: Entidad que </span><b>puede</b><span style="font-weight: 400;"> otorgar acceso a un recurso protegido, normalmente el usuario final.</span></li>
<li aria-level="1" style="font-weight: 400; list-style-position: outside; margin-bottom: 0.2em; margin-top: 0.2em;"><b>Cliente/ Client</b><span style="font-weight: 400;">: Aplicación que solicita acceso a un recurso protegido en </span><b>nombre del propietario del recurso</b><span style="font-weight: 400;">. Destacar que el concepto de cliente en el estándar recae sobre esta entidad.</span></li>
<li aria-level="1" style="font-weight: 400; list-style-position: outside; margin-bottom: 0.2em; margin-top: 0.2em;"><b>Servidor de recursos/Resource Server</b><span style="font-weight: 400;">: Servidor en el que se encuentra el recurso al que el cliente quiere acceder y para la que necesita la autorización del propietario.</span></li>
<li aria-level="1" style="font-weight: 400; list-style-position: outside; margin-bottom: 0.2em; margin-top: 0.2em;"><b>Servidor de autorización/Authorization Server</b><span style="font-weight: 400;">:Elemento que </span><b>autentica al propietario</b><span style="font-weight: 400;"> del recurso, solicita el permiso de este y en caso de ser afirmativo y emite un </span><b>token </b><span style="font-weight: 400;"> para  ese </span><b>cliente y recurso concreto </b><span style="font-weight: 400;"> que presentará ante el </span><b>servidor de recursos </b><span style="font-weight: 400;"> para acceder al mismo.</span></li>
</ul>
<p><span style="font-weight: 400;">Destacar que OAuth admite diferentes tipos y formatos de token, como el de revocación, renovación, o acceso (este último puede usar JWT)</span></p>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice em_iDevice_parasabermasfpd" id="id263">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Para saber más</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta263_128" class="block iDevice_content">
<figure class="exe-figure exe-media position-center" style="width: 400px;"><iframe width="400" height="314" src="https://www.youtube.com/embed/GeXbsMezj8s" allowfullscreen="allowfullscreen"></iframe>
<figcaption class="figcaption"><span class="title"><em>¿Qué es OAth2?</em></span></figcaption>
</figure>
<div class="exe-fx exe-accordion">
<h2>Descripción textual alternativa.</h2>
<p>Definición de OAth2, que problemas resuelve,scriba su contenido, casos de uso o roles entre otros.</p>
</div>
<p><span style="font-weight: 400;">La secuencia para la autenticación y autorización en OAuth2.0 por parte de una aplicación cliente dependerá en parte del tipo de aplicación y de la plataforma que implemente el servidor de recursos y autenticación, si bien el proceso general es muy similar, pueden existir diferencia entre diferentes plataformas, por ejemplo en Google es necesario registrar la aplicación cliente previamente y autorizar.</span></p>
<p><span style="font-weight: 400;">En un caso general con uso de los servicios en la parte de servidor de cliente (lenguaje PHP, Java, Python…) la secuencia es:</span></p>
<div class="exe-fx exe-accordion">
<h2>Paso previo.</h2>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Dar de alta a la aplicación web en la plataforma a utilizar. El alta se indica:</span>
<ul>
<li aria-level="2" style="font-weight: 400;"><span style="font-weight: 400;">Nombre de la aplicación.</span></li>
<li aria-level="2" style="font-weight: 400;"><span style="font-weight: 400;">Sitio web de la aplicación.</span></li>
<li aria-level="2" style="font-weight: 400;"><span style="font-weight: 400;">URL de </span><b>callback,</b><span style="font-weight: 400;"> el servidor de autorización redirigirá al propietario del recurso una vez se resuelva la solicitud de autorización.</span></li>
</ul>
</li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Junto con el alta se obtienen las </span><b>credenciales </b><span style="font-weight: 400;">que el cliente presentará al propietario del recurso (</span><b>URL de autenticación</b><span style="font-weight: 400;">) y al servidor de autorización, y la clave del cliente que presentará al servidor de recursos junto con la autorización para acceder al recurso o API.</span></li>
</ul>
<p><span style="font-weight: 400;">En este punto la aplicación se encuentra dada de alta y el cliente posee las credenciales a presentar ante el propietario y ante el servidor de recursos.</span></p>
<h2>Paso 1.</h2>
<p><span style="font-weight: 400;">Un usuario que no se encuentra registrado en la aplicación cliente desea entrar, ofreciendo al usuario la posibilidad de autenticarse con otras aplicaciones (normalmente Google, Facebook, Twitter..), al pulsar el enlace se abrirá una página con la </span><b>URL de autenticación</b><span style="font-weight: 400;"> otorgada por el servidor al cliente al dar de alta la aplicación y otros parámetros que indican las características de la solicitud del cliente al servidor. Un ejemplo de dicha URL para los servicios de Google:</span></p>
<p><a href="https://accounts.google.com/o/oauth2/v2/auth"><span style="font-weight: 400;">https://accounts.google.com/o/oauth2/v2/auth</span></a></p>
<p><span style="font-weight: 400;">A la que se le añaden diversos parámetros, siendo los siguientes obligatorios:</span></p>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">client_id. Otorgado anteriormente.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">redirect_ulr. Redirección a la que se lleva al usuario una vez realizado el proceso.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">response_type: Si el servidor devuelve código de autorización.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">scope: ámbito, recursos a los que solicita acceso..</span></li>
</ul>
<h2><span style="font-weight: 400;">Paso 2</span></h2>
<p><span style="font-weight: 400;">En esta nueva página el usuario facilitará sus credenciales y autorizará al cliente para acceder a los recursos que se indican:</span></p>
<figure class="exe-figure exe-image position-center" style="width: 500px; text-align: left;"><img width="500" height="420" style="margin-right: auto; margin-left: auto; display: block;" alt="Punto de entrada a autenticación OAth2." src="oath2.png" hspace="auto" />
<figcaption class="figcaption"><span class="title"><em>Punto de entrada a autenticación OAth2.<br /><br /><br /></em></span></figcaption>
</figure>
<h2><b>Paso 3. </b></h2>
<p><span style="font-weight: 400;">Si la autenticación ha sido correcta, el servidor redirige al usuario a la url indicada en url de autenticación facilitada por el cliente y </span><b>envía a la url de callback que indico el cliente al dar de alta la aplicación un código de autorización.</b></p>
<h2><b>Paso 4.</b></h2>
<p><span style="font-weight: 400;">El cliente con el código de autorización y otros detalles como el secreto del cliente indicados en la creación solicita un token de acceso al punto de entrada de la API</span></p>
<h2><b>Paso 5.</b></h2>
<p><span style="font-weight: 400;">El punto de acceso válida el código de autorización junto con el secreto del cliente y genera un token de acceso.</span></p>
<h2><b>Paso 6.</b></h2>
<p><span style="font-weight: 400;">Con el token de acceso la aplicación cliente puede acceder a los recursos autorizados por el propietario.</span></p>
</div>
<p><span style="font-weight: 400;"></span></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice em_iDevice_debesconocerfpd" id="id264">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Debes conocer</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta264_129" class="block iDevice_content">
<figure class="exe-figure exe-media position-center" style="width: 300px;"><iframe width="300" height="314" src="https://www.youtube.com/embed/CPbvxxslDTU" allowfullscreen="allowfullscreen"></iframe>
<figcaption class="figcaption"><span class="title"><em>Funcionamiento básico de OAth2.</em></span></figcaption>
</figure>
<div class="exe-fx exe-accordion">
<h2>Descripción textual alternativa</h2>
<p>Ejemplo funcionamiento básico de OAth2.</p>
</div>
<p></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id265">
<div class="iDevice emphasis0">
<div id="ta265_154" class="block iDevice_content">
<p><span style="font-weight: 400;">En algunos tipos de aplicación no es posible garantizar el </span><b>secreto del cliente </b><span style="font-weight: 400;"> con lo que se han de definir métodos alternativos de autenticación:</span></p>
<div class="exe-fx exe-accordion">
<h2><b>Código de autorización</b></h2>
<p><span style="font-weight: 400;">Por defecto en aplicaciones web con lógica en el servidor</span></p>
<h2><b>Implícito</b></h2>
<p><span style="font-weight: 400;"> Para aplicaciones nativas o aplicaciones web en el navegador. No es posible incluir el secreto del cliente en el código fuente ya que sería fácilmente accesible. El servidor de autenticación genera el token de acceso y lo facilita al cliente, sin pasar por el servidor de recursos.</span></p>
<h2><b>Credenciales de contraseña</b><span style="font-weight: 400;"> del propietario del recurso: </span></h2>
<p><span style="font-weight: 400;">utilizado con aplicaciones confiables, como aquellas pertenecientes al servicio, el usuario facilita su usuario y contraseña al cliente y este las presenta ante el servidor. Normalmente las aplicaciones de servidor y cliente son de la misma organización y confían mutuamente entre ellas. </span></p>
<h2><b>Credenciales del cliente</b></h2>
<p><span style="font-weight: 400;">Usadas con el acceso API de aplicaciones, la aplicación cliente entrega sus credenciales(id del cliente y su secreto) obteniendo un token de acceso para acceder a su propia cuenta.</span></p>
</div>
<p></p>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="5211__ejemplo_prctico_con_nodejs.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="6__robo_de_sesin.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>