<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_effects.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4.2. - Validación en el servidor. | UD 3: Detección y corrección de vulnerabilidades en aplicaciones web </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Pedro Antonio Santiago Santiago y José Gaspar Sánchez García" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_effects.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-120"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">UD 3: Detección y corrección de vulnerabilidades en aplicaciones web</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UD3. DETECCIÓN Y CORRECCIÓN DE VULNERABILIDADES DE APLICACIONES WEB</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li><a href="introduccin.html" class="no-ch">Introducción</a></li>
   <li><a href="1_protocolo_http.html" class="daddy">1.- Protocolo HTTP.</a>
   <ul class="other-section">
      <li><a href="11_formato_del_mensaje_http.html" class="no-ch">1.1.- Formato del mensaje HTTP.</a></li>
      <li><a href="12_versiones_del_protocolo.html" class="no-ch">1.2.- Versiones del protocolo.</a></li>
      <li><a href="13_tecnologas_web.html" class="no-ch">1.3. -Tecnologías Web.</a></li>
   </ul>
   </li>
   <li><a href="2desarrollo_seguro_de_aplicaciones_web.html" class="no-ch">2.-Desarrollo seguro de aplicaciones web.</a></li>
   <li><a href="3_listas_pblicas_de_vulnerabilidades_de_aplicaciones_web_owasp_top_ten.html" class="daddy">3.- Listas públicas de vulnerabilidades de aplicaciones web. OWASP Top Ten.</a>
   <ul class="other-section">
      <li><a href="31__inyeccin.html" class="no-ch">3.1. - Inyección.</a></li>
      <li><a href="32__prdida_de_autenticacin.html" class="no-ch">3.2. - Pérdida de autenticación.</a></li>
      <li><a href="33__exposicin_de_datos_sensibles.html" class="no-ch">3.3. - Exposición de datos sensibles.</a></li>
      <li><a href="34__entidades_externas_xml_xxe.html" class="no-ch">3.4. - Entidades externas XML (XXE).</a></li>
      <li><a href="35_prdida_de_control_de_acceso.html" class="no-ch">3.5. -Pérdida de Control de Acceso.</a></li>
      <li><a href="36_configuracin_de_seguridad_incorrecta.html" class="no-ch">3.6. -Configuración de seguridad incorrecta.</a></li>
      <li><a href="37__crosssite_scriptingxss.html" class="no-ch">3.7. - Cross-Site Scripting(XSS).</a></li>
      <li><a href="38__deserializacin_insegura.html" class="no-ch">3.8. - Deserialización insegura.</a></li>
      <li><a href="39__componentes_con_vulnerabilidades_conocidas.html" class="no-ch">3.9. - Componentes con vulnerabilidades conocidas.</a></li>
      <li><a href="310__registro_y_monitoreo_insuficientes.html" class="no-ch">3.10. - Registro y monitoreo insuficientes.</a></li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="4_entrada_basada_en_formularios_inyeccin_validacin_de_la_entrada.html" class="current-page-parent daddy">4.- Entrada basada en formularios. Inyección. Validación de la entrada.</a>
   <ul>
      <li><a href="41__validacin_en_el_cliente.html" class="daddy">4.1. - Validación en el cliente.</a>
      <ul class="other-section">
         <li><a href="411_ejemplo_prctico_con_angular.html" class="no-ch">4.1.1.- Ejemplo práctico con Angular.</a></li>
      </ul>
      </li>
      <li id="active"><a href="42__validacin_en_el_servidor.html" class="active daddy">4.2. - Validación en el servidor.</a>
      <ul>
         <li><a href="421_ejemplo_prctico_con_nodejs.html" class="no-ch">4.2.1.- Ejemplo práctico con NodeJs</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="5__estndares_de_autenticacin_y_autorizacin.html" class="daddy">5. - Estándares de autenticación y autorización.</a>
   <ul class="other-section">
      <li><a href="51__elementos_de_un_sistema_de_autenticacin_y_autorizacin_bsico.html" class="no-ch">5.1. - Elementos de un sistema de autenticación y autorización básico.</a></li>
      <li><a href="52__estndares.html" class="daddy">5.2. - Estándares.</a>
      <ul class="other-section">
         <li><a href="521__tokens_jwt.html" class="daddy">5.2.1. - Tokens JWT</a>
         <ul class="other-section">
            <li><a href="5211__ejemplo_prctico_con_nodejs.html" class="no-ch">5.2.1.1. - Ejemplo práctico con NodeJs.</a></li>
         </ul>
         </li>
         <li><a href="522__oath.html" class="no-ch">5.2.2. - OAth.</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="6__robo_de_sesin.html" class="no-ch">6. - Robo de sesión.</a></li>
   <li><a href="7__almacenamiento_seguro_de_contraseas.html" class="daddy">7. - Almacenamiento seguro de contraseñas.</a>
   <ul class="other-section">
      <li><a href="71_ejemplo_almacenamiento_seguro_nodejs.html" class="no-ch">7.1.- Ejemplo almacenamiento seguro NodeJs.</a></li>
   </ul>
   </li>
   <li><a href="8__contramedidas_hsts_csp_captchas_entre_otros.html" class="daddy">8. - Contramedidas. HSTS, CSP, CAPTCHAs, entre otros.</a>
   <ul class="other-section">
      <li><a href="81__hsts_http_strict_transport_security.html" class="no-ch">8.1. - HSTS (HTTP Strict Transport Security)</a></li>
      <li><a href="82__csp_content_security_policy.html" class="no-ch">8.2. - CSP (Content Security Policy)</a></li>
      <li><a href="83__captchas.html" class="no-ch">8.3. - CAPTCHAs</a></li>
   </ul>
   </li>
   <li><a href="9__seguridad_de_portales_y_aplicativos_web_soluciones_wafweb_application_firewall.html" class="no-ch">9. - Seguridad de portales y aplicativos web. Soluciones WAF(Web Application Firewall).</a></li>
   <li><a href="caso_prctico.html" class="no-ch">Caso práctico.</a></li>
   <li><a href="glosario.html" class="no-ch">Glosario</a></li>
   <li><a href="bibliografa.html" class="no-ch">Bibliografía</a></li>
   <li><a href="resumen.html" class="no-ch">Resumen</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="411_ejemplo_prctico_con_angular.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="421_ejemplo_prctico_con_nodejs.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">4.2. - Validación en el servidor.</h1></header>
<article class="iDevice_wrapper FreeTextIdevice" id="id244">
<div class="iDevice emphasis0">
<div id="ta244_85" class="block iDevice_content">
<p><span style="font-weight: 400;">Si bien la validación en el cliente es importante lo es más en el servidor ya que es el elemento intermedio que interactúa con las bases de datos, otros sistemas, los servicios de directorio o el sistema operativo.</span></p>
<p><span style="font-weight: 400;">Cada uno de los lenguajes de programación en el servidor y más concretamente cada framework establece diferentes sistemas de validación de formularios incluyendo normalmente funciones o métodos para</span><b> “sanear”</b><span style="font-weight: 400;"> o </span><b>“desinfectar”</b><span style="font-weight: 400;"> los parámetros recibidos, ya sea a través de la “querystring” o en el cuerpo del mensaje, consistiendo en eliminar o codificar los caracteres que pueden utilizarse para un ataque, como &lt;, true, =.... A continuación.</span></p>
<p></p>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">En php se dispone de la función filter_var y una serie de</span><a href="https://www.php.net/manual/es/filter.filters.sanitize.php"><span style="font-weight: 400;"> filtros predefinidos</span></a><span style="font-weight: 400;"> como FILTER_SANITIZE_EMAIL que elimina todos los caracteres menos letras, dígitos y !#$%&amp;'*+-=?^_`{|}~@.[].</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">En caso de python existen diferentes funciones y varios paquetes/librerías como </span><a href="https://pypi.org/project/bleach/"><span style="font-weight: 400;">Bleach</span></a><span style="font-weight: 400;"> o </span><a href="https://pypi.org/project/sanitize/"><span style="font-weight: 400;">Sanitize</span></a><span style="font-weight: 400;">, aunque este último lleva tiempo sin actualizar en la entrada de los datos, en la salida algunos motores de plantillas puede “desinfectar” las cadenas extraídas para evitar ataques como el XSS, como </span><a href="https://jinja.palletsprojects.com/en/2.11.x/"><span style="font-weight: 400;">Jinja</span></a><span style="font-weight: 400;"> y la directiva {% autoescape true%}, en Django, el framework más conocido en Python la “desinfección” se realiza de aunque existen paquetes y librerías especializados como </span><a href="https://pypi.org/project/django-xss-fuzzer/"><span style="font-weight: 400;">Django Xss-Fuzze</span></a><span style="font-weight: 400;">r</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Con Java sucede algo similar, existen una serie de clases y métodos del lenguaje como expresiones regulares , librerías externas, por ejemplo </span><a href="https://owasp.org/www-project-java-encoder/"><span style="font-weight: 400;">OWASP Java Encoder</span></a><span style="font-weight: 400;"> de la fundación OWASP o el paquete</span><a href="https://commons.apache.org/proper/commons-lang/"><span style="font-weight: 400;"> lang</span></a><span style="font-weight: 400;"> de Apache Fundation que define diferentes métodos para “desinfectar” entre ellos </span><a href="https://commons.apache.org/proper/commons-text/javadocs/api-release/org/apache/commons/text/StringEscapeUtils.html"><span style="font-weight: 400;">StringEscapeUtils</span></a><span style="font-weight: 400;"> que protege ante codigo Java, Javascript, HTML y XML.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">En  NodeJS existen diferentes librerías que permiten la validación de datos como</span></li>
</ul>
<p><span style="font-weight: 400;">Para el resto de los lenguajes como Ruby o cualquier otro es necesario realizar un proceso de investigación.</span></p>
</div>
</div>
</article>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id245">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta245_151" class="block iDevice_content">
<p><span style="font-weight: 400;">Es necesario validar los datos en el servidor para evitar ataques de inyección de dependencias, XSS o XXE, ya sea utilizando los elementos incluidos en el lenguaje con librerías externas o asegurándose que el entorno de trabajo filtra los datos.</span></p>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id246">
<div class="iDevice emphasis0">
<div id="ta246_154" class="block iDevice_content">
<p><span style="font-weight: 400;">La vulnerabilidad más peligrosa es la inyección de código, en especial la de SQL. Recordar que existe una </span><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html"><span style="font-weight: 400;">hoja de trucos</span></a><span style="font-weight: 400;"> de la fundación OWASP con recomendaciones para evitar este tipo de ataques. Se hace </span><b>imprescindible</b><span style="font-weight: 400;">:</span></p>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;"><strong>Utilizar consultas parametrizadas</strong>. Las librerías de los lenguajes que interactuan con las bases de datos permiten crear consultas SQL parametrizadas, estas consultas son “compiladas” de forma que no es posible modificar las tablas que se utilizan o instrucciones cómo JOIN o WHERE, algunas librerías permiten comprobar además el tipo de dato a pasar a la consulta.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;"><strong>Usar procedimientos almacenados</strong>. Las bases de datos, en especial las estructuradas permiten definir procedimientos de forma interna, realizando una parametrización de la consulta. Un ejemplo en MySQL:</span></li>
</ul>
<div class="highlighted-code language-sql">
<div>
<pre><code>DELIMITER //
CREATE PROCEDURE `First`(
    IN Username VARCHAR(50),
    IN Password VARCHAR(50)
)
BEGIN

    SET @Statement = CONCAT('SELECT * FROM User WHERE username = ', Username, ' AND password = ', Password);

    PREPARE stm FROM @Statement;
    EXECUTE stm;

END //
DELIMITER ;
</code></pre>
</div>
</div>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Comprobación de parámetros dinámicos. En ocasiones la sentencia SQL no se conoce hasta que se reciben los parámetros, por ejemplo la ordenación ascendente o descendente, los campos de ordenación, el nombre de las tablas o de campos a seleccionar o modificar. Una de las posibles soluciones es evaluar el valor de los parámetros asignando a una variable un valor que dependerá de los datos enviados, utilizando una sentencia alternativa múltiple, un ejemplo extraído del libro de trucos:</span></li>
</ul>
<div class="highlighted-code language-sql">
<div>
<pre><code>String tableName;
switch(PARAM):
  case "Value1": tableName = "fooTable";
                 break;
  case "Value2": tableName = "barTable";
                 break;
  ...
  default      : throw new InputValidationException("unexpected value provided"
                                                  + " for table name");
</code></pre>
</div>
</div>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-weight: 400;">Escapar los datos de usuario: Consiste en sustituir ciertos caracteres que se considera peligrosos por otros, es decir codificar la entrada, al recuperar los datos se ha de realizar el procedimiento inverso. Esta técnica protege ante SQL Injection pero posiblemente no protege ante XSS en caso de “desescapar”. No se recomienda su uso a menos que sea necesario por código heredado, utilizándose preferentemente consultas parametrizadas, procedimientos almacenados y en especial ORM fiables para la interacción con la base de datos.</span></li>
</ul>
</div>
</div>
</article>
<article class="iDevice_wrapper DebesconocerfpdIdevice em_iDevice em_iDevice_debesconocerfpd" id="id247">
<div class="iDevice emphasis_debesconocerfpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Debes conocer</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta247_129" class="block iDevice_content">
<p style="text-align: center;"><iframe width="500" height="314" allowfullscreen="allowfullscreen" src="https://www.youtube.com/embed/x8POnTp5TUA"></iframe> <iframe width="500" height="314" allowfullscreen="allowfullscreen" src="https://www.youtube.com/embed/dHMxcTCcD2c"></iframe><br /><br /></p>
<div class="exe-fx exe-accordion">
<h2>Descripción textual alternativa.</h2>
<p>Vídeos del Master Universitario en Ingeniería Web de la UPM sobre inyección SQL.</p>
</div>
<p style="text-align: center;"></p>
</div>
</div>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="411_ejemplo_prctico_con_angular.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="421_ejemplo_prctico_con_nodejs.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>