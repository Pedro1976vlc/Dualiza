<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_effects.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>3.1. - Inyección. | UD 3: Detección y corrección de vulnerabilidades en aplicaciones web </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="Pedro Antonio Santiago Santiago y José Gaspar Sánchez García" />
<meta name="generator" content="eXeLearning 2.6 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_effects.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-104"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">UD 3: Detección y corrección de vulnerabilidades en aplicaciones web</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UD3. DETECCIÓN Y CORRECCIÓN DE VULNERABILIDADES DE APLICACIONES WEB</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li><a href="introduccin.html" class="no-ch">Introducción</a></li>
   <li><a href="1_protocolo_http.html" class="daddy">1.- Protocolo HTTP.</a>
   <ul class="other-section">
      <li><a href="11_formato_del_mensaje_http.html" class="no-ch">1.1.- Formato del mensaje HTTP.</a></li>
      <li><a href="12_versiones_del_protocolo.html" class="no-ch">1.2.- Versiones del protocolo.</a></li>
      <li><a href="13_tecnologas_web.html" class="no-ch">1.3. -Tecnologías Web.</a></li>
   </ul>
   </li>
   <li><a href="2desarrollo_seguro_de_aplicaciones_web.html" class="no-ch">2.-Desarrollo seguro de aplicaciones web.</a></li>
   <li class="current-page-parent"><a href="3_listas_pblicas_de_vulnerabilidades_de_aplicaciones_web_owasp_top_ten.html" class="current-page-parent daddy">3.- Listas públicas de vulnerabilidades de aplicaciones web. OWASP Top Ten.</a>
   <ul>
      <li id="active"><a href="31__inyeccin.html" class="active no-ch">3.1. - Inyección.</a></li>
      <li><a href="32__prdida_de_autenticacin.html" class="no-ch">3.2. - Pérdida de autenticación.</a></li>
      <li><a href="33__exposicin_de_datos_sensibles.html" class="no-ch">3.3. - Exposición de datos sensibles.</a></li>
      <li><a href="34__entidades_externas_xml_xxe.html" class="no-ch">3.4. - Entidades externas XML (XXE).</a></li>
      <li><a href="35_prdida_de_control_de_acceso.html" class="no-ch">3.5. -Pérdida de Control de Acceso.</a></li>
      <li><a href="36_configuracin_de_seguridad_incorrecta.html" class="no-ch">3.6. -Configuración de seguridad incorrecta.</a></li>
      <li><a href="37__crosssite_scriptingxss.html" class="no-ch">3.7. - Cross-Site Scripting(XSS).</a></li>
      <li><a href="38__deserializacin_insegura.html" class="no-ch">3.8. - Deserialización insegura.</a></li>
      <li><a href="39__componentes_con_vulnerabilidades_conocidas.html" class="no-ch">3.9. - Componentes con vulnerabilidades conocidas.</a></li>
      <li><a href="310__registro_y_monitoreo_insuficientes.html" class="no-ch">3.10. - Registro y monitoreo insuficientes.</a></li>
   </ul>
   </li>
   <li><a href="4_entrada_basada_en_formularios_inyeccin_validacin_de_la_entrada.html" class="daddy">4.- Entrada basada en formularios. Inyección. Validación de la entrada.</a>
   <ul class="other-section">
      <li><a href="41__validacin_en_el_cliente.html" class="daddy">4.1. - Validación en el cliente.</a>
      <ul class="other-section">
         <li><a href="411_ejemplo_prctico_con_angular.html" class="no-ch">4.1.1.- Ejemplo práctico con Angular.</a></li>
      </ul>
      </li>
      <li><a href="42__validacin_en_el_servidor.html" class="daddy">4.2. - Validación en el servidor.</a>
      <ul class="other-section">
         <li><a href="421_ejemplo_prctico_con_nodejs.html" class="no-ch">4.2.1.- Ejemplo práctico con NodeJs</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="5__estndares_de_autenticacin_y_autorizacin.html" class="daddy">5. - Estándares de autenticación y autorización.</a>
   <ul class="other-section">
      <li><a href="51__elementos_de_un_sistema_de_autenticacin_y_autorizacin_bsico.html" class="no-ch">5.1. - Elementos de un sistema de autenticación y autorización básico.</a></li>
      <li><a href="52__estndares.html" class="daddy">5.2. - Estándares.</a>
      <ul class="other-section">
         <li><a href="521__tokens_jwt.html" class="daddy">5.2.1. - Tokens JWT</a>
         <ul class="other-section">
            <li><a href="5211__ejemplo_prctico_con_nodejs.html" class="no-ch">5.2.1.1. - Ejemplo práctico con NodeJs.</a></li>
         </ul>
         </li>
         <li><a href="522__oath.html" class="no-ch">5.2.2. - OAth.</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="6__robo_de_sesin.html" class="no-ch">6. - Robo de sesión.</a></li>
   <li><a href="7__almacenamiento_seguro_de_contraseas.html" class="daddy">7. - Almacenamiento seguro de contraseñas.</a>
   <ul class="other-section">
      <li><a href="71_ejemplo_almacenamiento_seguro_nodejs.html" class="no-ch">7.1.- Ejemplo almacenamiento seguro NodeJs.</a></li>
   </ul>
   </li>
   <li><a href="8__contramedidas_hsts_csp_captchas_entre_otros.html" class="daddy">8. - Contramedidas. HSTS, CSP, CAPTCHAs, entre otros.</a>
   <ul class="other-section">
      <li><a href="81__hsts_http_strict_transport_security.html" class="no-ch">8.1. - HSTS (HTTP Strict Transport Security)</a></li>
      <li><a href="82__csp_content_security_policy.html" class="no-ch">8.2. - CSP (Content Security Policy)</a></li>
      <li><a href="83__captchas.html" class="no-ch">8.3. - CAPTCHAs</a></li>
   </ul>
   </li>
   <li><a href="9__seguridad_de_portales_y_aplicativos_web_soluciones_wafweb_application_firewall.html" class="no-ch">9. - Seguridad de portales y aplicativos web. Soluciones WAF(Web Application Firewall).</a></li>
   <li><a href="caso_prctico.html" class="no-ch">Caso práctico.</a></li>
   <li><a href="glosario.html" class="no-ch">Glosario</a></li>
   <li><a href="bibliografa.html" class="no-ch">Bibliografía</a></li>
   <li><a href="resumen.html" class="no-ch">Resumen</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="3_listas_pblicas_de_vulnerabilidades_de_aplicaciones_web_owasp_top_ten.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="32__prdida_de_autenticacin.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">3.1. - Inyección.</h1></header>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id189">
<div class="iDevice emphasis0">
<div id="ta189_154" class="block iDevice_content">

</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id190">
<div class="iDevice emphasis0">
<div id="ta190_154" class="block iDevice_content">
<p><span style="font-weight: 400;">Una de l<span style="font-size: 12pt;">as vulnerabilidades más utilizadas destacadas que <strong>no solo afectan a las aplicaciones web</strong>, pero si especialmente a estas ya que no es necesario disponer del software instalado (nativo) y <strong>se puede realizar desde cualquier dispositivo</strong> (no se conoce en principio el dispositivo que realiza el ataque).</span></span></p>
<figure class="exe-figure exe-image position-center license-CC0" style="width: 499px;"><a href="A1_Inyeccion.png" onclick="window.open('A1_Inyeccion.png','Inyección','scrollbars=yes,resizable=yes,width=800,height=600,left='+(screen.availWidth/2-400)+',top='+(screen.availHeight/2-300)+'');return false;"><img src="A1_Inyeccion.png" alt="Valoración de la vulnerabilidad " width="499" height="168" /></a>
<figcaption class="figcaption"><a href="https://owasp.org" target="_blank" class="author" rel="noopener">OWASP Fundation</a>. <span class="title"><em>Valoración de la vulnerabilidad </em></span> <span class="license"><span class="sep">(</span><a href="http://creativecommons.org/publicdomain/zero/1.0/deed.es" rel="license nofollow noopener" target="_blank" title="Creative Commons (CC0)">CC0</a><span class="sep">)</span></span></figcaption>
</figure>
<p><span style="font-size: 12pt; font-weight: 400;">El software en el servidor realiza peticiones a otros servicios en modo texto, conociendo el servicio que se consulta o en el que se ejecuta alguna acción y el lenguaje que se utiliza para ello es posible enviar un texto que ejecute ciertos comandos no deseados en el servidor. </span></p>
<p><span style="font-size: 12pt; font-weight: 400;">El ejemplo clásico son consultas <strong>SQL</strong>, aunque también se dan en consultas <strong>LDAP</strong> (servicio de directorio, similar a una base de datos pero que es capaz de almacenar datos heterogéneos y la mayor parte de las consultas son de lecturas), bases de datos NoSQL o <strong>ejecución de comandos en el terminal</strong>.</span></p>
<p><span style="font-size: 12pt; font-weight: 400;">Las aplicaciones vulnerables a estos ataques poseen las siguientes características:</span></p>
<ul>
<li aria-level="1" style="font-weight: 400;"><span style="font-size: 12pt; font-weight: 400;">No se filtran y validan los datos en el cliente y especialmente en el servidor.</span></li>
<li aria-level="1" style="font-weight: 400;"><span style="font-size: 12pt; font-weight: 400;">Se ejecutan consultas sin pasar previamente por un analizador de parámetros, concatenando en una cadena los valores recibidos y no se utilizan consultas parametrizadas.</span></li>
</ul>
<p><span style="font-size: 12pt; font-weight: 400;">Un ejemplo de ataque SQL Injection puede ser un formulario de autenticación con el clásico usuario y clave. Un ejemplo de código en PHP para autenticar a un usuario:</span></p>
<div class="highlighted-code language-php line-numbers">
<div>
<pre><code>$consulta="select usuario,clave from usuarios where usuario=’”. $_POST['usuario'].”’ and clave=’”.$_POST[“clave”].”’”;
$result=mysql_query($query);
$rows = mysql_fetch_array($result);
if($rows){
create_session();
header( 'Location: privado.php' );
}
else{
header( 'Location: login.php' );
}</code></pre>
</div>
</div>
<p><span style="font-size: 12pt; font-weight: 400;">  Colocando el valor de usuario y clave con el valor: </span></p>
<div class="highlighted-code language-sql">
<div>
<pre><code>‘ or 1=1 </code></pre>
</div>
</div>
<p><br /><span style="font-weight: 400;">Se obtiene la consulta:</span></p>
<div class="highlighted-code language-sql">
<div>
<pre><code>select usuario,clave from usuarios where usuario=’pepe’ OR 1=’1 AND clave=’secreto’ OR 1=1</code></pre>
</div>
</div>
<p><br /><br /></p>
<p><span style="font-weight: 400;">que es cierta para todos los registros, por rows existe y se crea la sesión.</span></p>
<p></p>
</div>
</div>
</article>
<article class="iDevice_wrapper ParasabermasfpdIdevice em_iDevice em_iDevice_parasabermasfpd" id="id220">
<div class="iDevice emphasis_parasabermasfpd" >
<header class="iDevice_header"><h1 class="iDeviceTitle">Para saber más</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta220_128" class="block iDevice_content">
<figure class="exe-figure exe-media position-center" style="width: 500px;"><iframe width="500" height="314" data-mce-fragment="1" allowfullscreen="allowfullscreen" src="https://www.youtube.com/embed/QjeuNiQmRrc"></iframe>
<figcaption class="figcaption"><span class="title"><em>Injección en LDAP</em></span></figcaption>
</figure>
<div class="exe-fx exe-accordion">
<h2>Descripción textual alternativa</h2>
<p>Tratamiento de la inyección sobre servicios de directorio LDAP y recomendaciones para evitarlo.</p>
<p></p>
</div>
<p></p>
</div>
</div>
</div>
</div>
</article>
<article class="iDevice_wrapper FreeTextfpdIdevice" id="id221">
<div class="iDevice emphasis0">
<div id="ta221_154" class="block iDevice_content">
<p><span style="font-weight: 400;">Existe una hoja de trucos para mitigar y evitar este tipo de vulnerabilidad:</span></p>
<p style="text-align: center;"><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html"><span style="font-weight: 400;">https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html</span></a></p>
<p><span style="font-weight: 400;">Una parte de los casos de prueba deben de ir encaminados al testeo de las vulnerabilidades de inyección, además de revisiones de código.</span></p>
<p><span style="font-weight: 400;"></span></p>
</div>
</div>
</article>
<article class="iDevice_wrapper DestacadofpdIdevice" id="id222">
<div class="iDevice emphasis0" >
<div class="iDevice_destacadofpd">
<div id="ta222_151" class="block iDevice_content">
<p style="text-align: justify;"><span style="font-weight: 400;">Para evitar inyecciones se recomienda:</span></p>
<ul>
<li aria-level="1" style="text-align: justify; font-weight: 400;"><span style="font-weight: 400;">Utilizar API’s seguras para el acceso a los servicios y no realizarlos directamente, por ejemplo la instrucción EXEC en php para ejecutar un comando en el shell. En en caso de base de datos utilizar ORM seguros (los frameworks actuales en casi todos los lenguajes por no decir todos proveen de ORM propios o de terceros) y en caso de no utilizarlas usar consultas parametrizadas.</span></li>
<li aria-level="1" style="text-align: justify; font-weight: 400;"><span style="font-weight: 400;">Realizar validaciones en el cliente, pero </span><b>en especial en el servidor </b><span style="font-weight: 400;"> con los datos recibidos.</span></li>
<li aria-level="1" style="text-align: justify; font-weight: 400;"><span style="font-weight: 400;">Utilizar caracteres de escape en las consultas dinámicas.</span></li>
<li aria-level="1" style="text-align: justify; font-weight: 400;"><span style="font-weight: 400;">Usar las opciones del lenguaje de consultas para limitar los resultados, como LIMIT en SQL.</span></li>
</ul>
</div>
</div>
</div>
</article>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="3_listas_pblicas_de_vulnerabilidades_de_aplicaciones_web_owasp_top_ten.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="32__prdida_de_autenticacin.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>